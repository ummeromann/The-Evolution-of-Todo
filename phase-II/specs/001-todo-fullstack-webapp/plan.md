# Implementation Plan: Todo Full-Stack Web Application

**Branch**: `001-todo-fullstack-webapp` | **Date**: 2026-01-13 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-todo-fullstack-webapp/spec.md`

## Summary

Transform the Phase-I console Todo app into a multi-user web application with:
- FastAPI backend with RESTful API endpoints
- Neon PostgreSQL database with SQLModel ORM
- Better Auth authentication with JWT tokens
- Next.js 16+ frontend with App Router

The implementation follows strict separation of concerns across four layers: Database, Backend, Authentication, and Frontend.

## Technical Context

**Language/Version**: Python 3.11+ (Backend), TypeScript/Node.js 18+ (Frontend)
**Primary Dependencies**: FastAPI, SQLModel, Better Auth, Next.js 16+, Tailwind CSS
**Storage**: Neon Serverless PostgreSQL
**Testing**: pytest (Backend), Jest/React Testing Library (Frontend)
**Target Platform**: Web (Desktop and Mobile responsive)
**Project Type**: Web application (separated frontend/backend)
**Performance Goals**: Page load <3s, API response <500ms
**Constraints**: JWT-based auth, user data isolation, no manual coding
**Scale/Scope**: Multi-user, ~1000 concurrent users (hackathon demo scale)

## Constitution Check

*GATE: Must pass before implementation. Re-checked after design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Spec-Driven Development | PASS | This plan derived from approved spec.md |
| II. Zero Manual Coding | PASS | All implementation via Claude Code agents |
| III. Security by Design | PASS | JWT validation, user isolation in all queries |
| IV. Single Source of Truth | PASS | spec.md authoritative |
| V. Clean Separation of Concerns | PASS | Four distinct layers defined |
| VI. Reproducibility | PASS | Full plan documented, PHR records maintained |

## Project Structure

### Documentation (this feature)

```text
specs/001-todo-fullstack-webapp/
├── spec.md              # Feature specification
├── plan.md              # This file
├── research.md          # Technology research
├── data-model.md        # Entity definitions
├── quickstart.md        # Setup guide
├── contracts/           # API contracts
│   ├── openapi.yaml     # REST API specification
│   └── auth-flow.md     # Authentication flow
└── tasks.md             # Implementation tasks (generated by /sp.tasks)
```

### Source Code (repository root)

```text
backend/
├── app/
│   ├── __init__.py
│   ├── main.py              # FastAPI application entry
│   ├── config.py            # Environment configuration
│   ├── database.py          # Async database connection
│   ├── models/
│   │   ├── __init__.py
│   │   ├── user.py          # User SQLModel
│   │   └── task.py          # Task SQLModel
│   ├── schemas/
│   │   ├── __init__.py
│   │   ├── user.py          # User Pydantic schemas
│   │   └── task.py          # Task Pydantic schemas
│   ├── api/
│   │   ├── __init__.py
│   │   ├── deps.py          # Dependencies (auth, db)
│   │   └── routes/
│   │       ├── __init__.py
│   │       ├── health.py    # Health check
│   │       └── tasks.py     # Task CRUD endpoints
│   └── middleware/
│       ├── __init__.py
│       └── auth.py          # JWT validation middleware
├── alembic/
│   ├── versions/            # Migration files
│   └── env.py
├── tests/
│   ├── __init__.py
│   ├── conftest.py
│   ├── test_health.py
│   └── test_tasks.py
├── requirements.txt
├── alembic.ini
└── .env.example

frontend/
├── src/
│   ├── app/
│   │   ├── layout.tsx           # Root layout
│   │   ├── page.tsx             # Landing page
│   │   ├── (auth)/
│   │   │   ├── layout.tsx       # Auth layout
│   │   │   ├── signin/
│   │   │   │   └── page.tsx     # Sign-in page
│   │   │   └── signup/
│   │   │       └── page.tsx     # Sign-up page
│   │   └── (protected)/
│   │       ├── layout.tsx       # Protected layout
│   │       └── dashboard/
│   │           └── page.tsx     # Task dashboard
│   ├── components/
│   │   ├── ui/
│   │   │   ├── button.tsx
│   │   │   ├── input.tsx
│   │   │   └── card.tsx
│   │   ├── forms/
│   │   │   ├── signin-form.tsx
│   │   │   ├── signup-form.tsx
│   │   │   └── task-form.tsx
│   │   └── tasks/
│   │       ├── task-list.tsx
│   │       ├── task-item.tsx
│   │       └── empty-state.tsx
│   ├── lib/
│   │   ├── api.ts               # API client with JWT
│   │   ├── auth.ts              # Better Auth client
│   │   ├── auth-client.ts       # Better Auth client instance
│   │   └── utils.ts             # Utility functions
│   └── types/
│       └── index.ts             # TypeScript types
├── public/
├── package.json
├── tailwind.config.ts
├── tsconfig.json
├── next.config.ts
└── .env.local.example
```

**Structure Decision**: Web application with separated backend (FastAPI) and frontend (Next.js) as mandated by constitution. Better Auth runs within Next.js API routes.

---

## Implementation Phases

### Phase 1: Backend Core & Database Layer

**Agent**: `neon-postgres-architect` (database), `fastapi-backend` (API)
**Dependencies**: None
**Output**: Working backend with database and unprotected API endpoints

#### 1.1 Project Setup

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 1.1.1 | Create `backend/` directory structure | fastapi-backend | None |
| 1.1.2 | Create `requirements.txt` with dependencies | fastapi-backend | 1.1.1 |
| 1.1.3 | Create `.env.example` template | fastapi-backend | 1.1.1 |
| 1.1.4 | Create `app/__init__.py` files | fastapi-backend | 1.1.1 |

#### 1.2 Database Configuration

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 1.2.1 | Create `app/config.py` with environment loading | fastapi-backend | 1.1.3 |
| 1.2.2 | Create `app/database.py` with async engine | neon-postgres-architect | 1.2.1 |
| 1.2.3 | Initialize Alembic for migrations | neon-postgres-architect | 1.2.2 |

#### 1.3 Data Models

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 1.3.1 | Create `app/models/user.py` SQLModel | neon-postgres-architect | 1.2.2 |
| 1.3.2 | Create `app/models/task.py` SQLModel | neon-postgres-architect | 1.3.1 |
| 1.3.3 | Create `app/models/__init__.py` exports | neon-postgres-architect | 1.3.2 |
| 1.3.4 | Generate initial Alembic migration | neon-postgres-architect | 1.3.3 |

#### 1.4 Pydantic Schemas

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 1.4.1 | Create `app/schemas/user.py` schemas | fastapi-backend | 1.3.1 |
| 1.4.2 | Create `app/schemas/task.py` schemas | fastapi-backend | 1.3.2 |
| 1.4.3 | Create `app/schemas/__init__.py` exports | fastapi-backend | 1.4.2 |

#### 1.5 API Endpoints (Unprotected Initially)

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 1.5.1 | Create `app/api/deps.py` with DB session dependency | fastapi-backend | 1.2.2 |
| 1.5.2 | Create `app/api/routes/health.py` endpoint | fastapi-backend | 1.5.1 |
| 1.5.3 | Create `app/api/routes/tasks.py` CRUD endpoints | fastapi-backend | 1.5.1, 1.4.2 |
| 1.5.4 | Create `app/api/routes/__init__.py` router | fastapi-backend | 1.5.3 |
| 1.5.5 | Create `app/main.py` FastAPI application | fastapi-backend | 1.5.4 |

#### 1.6 Phase 1 Validation

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 1.6.1 | Run database migration | neon-postgres-architect | 1.3.4 |
| 1.6.2 | Start backend server | fastapi-backend | 1.5.5 |
| 1.6.3 | Verify health endpoint returns 200 | fastapi-backend | 1.6.2 |
| 1.6.4 | Verify OpenAPI docs at /docs | fastapi-backend | 1.6.2 |

---

### Phase 2: Authentication & Security Integration

**Agent**: `auth-security` (authentication), `fastapi-backend` (middleware)
**Dependencies**: Phase 1 complete
**Output**: JWT-protected API endpoints with user isolation

#### 2.1 Better Auth Setup (Frontend Side)

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 2.1.1 | Create `frontend/` directory structure | nextjs-frontend-builder | Phase 1 |
| 2.1.2 | Initialize Next.js project with TypeScript | nextjs-frontend-builder | 2.1.1 |
| 2.1.3 | Install Better Auth dependencies | auth-security | 2.1.2 |
| 2.1.4 | Create `src/lib/auth.ts` Better Auth config | auth-security | 2.1.3 |
| 2.1.5 | Create `src/lib/auth-client.ts` client instance | auth-security | 2.1.4 |
| 2.1.6 | Create `src/app/api/auth/[...all]/route.ts` | auth-security | 2.1.5 |

#### 2.2 JWT Validation (Backend Side)

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 2.2.1 | Add PyJWT to `requirements.txt` | auth-security | 2.1.6 |
| 2.2.2 | Create `app/middleware/auth.py` JWT validator | auth-security | 2.2.1 |
| 2.2.3 | Update `app/api/deps.py` with `get_current_user` | auth-security | 2.2.2 |
| 2.2.4 | Update `app/api/routes/tasks.py` to require auth | auth-security | 2.2.3 |

#### 2.3 User Isolation

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 2.3.1 | Update task list query to filter by user_id | auth-security | 2.2.4 |
| 2.3.2 | Update task create to set user_id from JWT | auth-security | 2.2.4 |
| 2.3.3 | Update task update to verify ownership | auth-security | 2.2.4 |
| 2.3.4 | Update task delete to verify ownership | auth-security | 2.2.4 |
| 2.3.5 | Update task toggle to verify ownership | auth-security | 2.2.4 |

#### 2.4 Error Handling

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 2.4.1 | Create custom HTTPException for 401 responses | fastapi-backend | 2.2.4 |
| 2.4.2 | Create custom HTTPException for 403 responses | fastapi-backend | 2.3.5 |
| 2.4.3 | Add global exception handler in main.py | fastapi-backend | 2.4.2 |

#### 2.5 CORS Configuration

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 2.5.1 | Add CORS middleware to main.py | fastapi-backend | 2.4.3 |
| 2.5.2 | Configure allowed origins from environment | fastapi-backend | 2.5.1 |

#### 2.6 Phase 2 Validation

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 2.6.1 | Verify 401 returned without token | auth-security | 2.5.2 |
| 2.6.2 | Verify 401 returned with invalid token | auth-security | 2.5.2 |
| 2.6.3 | Verify 200 returned with valid token | auth-security | 2.5.2 |
| 2.6.4 | Verify 403 returned for cross-user access | auth-security | 2.5.2 |

---

### Phase 3: Frontend Web Application

**Agent**: `nextjs-frontend-builder`
**Dependencies**: Phase 2 complete
**Output**: Complete working web application

#### 3.1 Project Configuration

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 3.1.1 | Configure Tailwind CSS | nextjs-frontend-builder | Phase 2 |
| 3.1.2 | Create `.env.local.example` template | nextjs-frontend-builder | 3.1.1 |
| 3.1.3 | Create `src/types/index.ts` type definitions | nextjs-frontend-builder | 3.1.2 |
| 3.1.4 | Create `src/lib/utils.ts` utility functions | nextjs-frontend-builder | 3.1.3 |

#### 3.2 API Client

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 3.2.1 | Create `src/lib/api.ts` with fetch wrapper | nextjs-frontend-builder | 3.1.4 |
| 3.2.2 | Add JWT token attachment to API client | nextjs-frontend-builder | 3.2.1 |
| 3.2.3 | Add error handling to API client | nextjs-frontend-builder | 3.2.2 |

#### 3.3 UI Components

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 3.3.1 | Create `src/components/ui/button.tsx` | nextjs-frontend-builder | 3.1.1 |
| 3.3.2 | Create `src/components/ui/input.tsx` | nextjs-frontend-builder | 3.1.1 |
| 3.3.3 | Create `src/components/ui/card.tsx` | nextjs-frontend-builder | 3.1.1 |
| 3.3.4 | Create loading spinner component | nextjs-frontend-builder | 3.1.1 |

#### 3.4 Authentication Pages

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 3.4.1 | Create `src/app/(auth)/layout.tsx` | nextjs-frontend-builder | 3.3.3 |
| 3.4.2 | Create `src/components/forms/signup-form.tsx` | nextjs-frontend-builder | 3.3.2 |
| 3.4.3 | Create `src/app/(auth)/signup/page.tsx` | nextjs-frontend-builder | 3.4.2 |
| 3.4.4 | Create `src/components/forms/signin-form.tsx` | nextjs-frontend-builder | 3.3.2 |
| 3.4.5 | Create `src/app/(auth)/signin/page.tsx` | nextjs-frontend-builder | 3.4.4 |

#### 3.5 Protected Layout

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 3.5.1 | Create `src/app/(protected)/layout.tsx` with auth check | nextjs-frontend-builder | 3.4.5 |
| 3.5.2 | Add redirect to signin if not authenticated | nextjs-frontend-builder | 3.5.1 |
| 3.5.3 | Add sign-out button to protected layout | nextjs-frontend-builder | 3.5.1 |

#### 3.6 Task Components

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 3.6.1 | Create `src/components/tasks/empty-state.tsx` | nextjs-frontend-builder | 3.3.3 |
| 3.6.2 | Create `src/components/tasks/task-item.tsx` | nextjs-frontend-builder | 3.3.3 |
| 3.6.3 | Create `src/components/tasks/task-list.tsx` | nextjs-frontend-builder | 3.6.2 |
| 3.6.4 | Create `src/components/forms/task-form.tsx` | nextjs-frontend-builder | 3.3.2 |

#### 3.7 Dashboard Page

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 3.7.1 | Create `src/app/(protected)/dashboard/page.tsx` | nextjs-frontend-builder | 3.6.3, 3.6.4 |
| 3.7.2 | Implement task list fetching | nextjs-frontend-builder | 3.7.1 |
| 3.7.3 | Implement task creation | nextjs-frontend-builder | 3.7.1 |
| 3.7.4 | Implement task update (edit description) | nextjs-frontend-builder | 3.7.1 |
| 3.7.5 | Implement task deletion | nextjs-frontend-builder | 3.7.1 |
| 3.7.6 | Implement task toggle (completion status) | nextjs-frontend-builder | 3.7.1 |

#### 3.8 Landing Page

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 3.8.1 | Create `src/app/layout.tsx` root layout | nextjs-frontend-builder | 3.7.6 |
| 3.8.2 | Create `src/app/page.tsx` landing page | nextjs-frontend-builder | 3.8.1 |
| 3.8.3 | Add navigation to signin/signup | nextjs-frontend-builder | 3.8.2 |

#### 3.9 Error Handling & UX

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 3.9.1 | Add loading states to all data operations | nextjs-frontend-builder | 3.7.6 |
| 3.9.2 | Add error message display for validation | nextjs-frontend-builder | 3.7.6 |
| 3.9.3 | Add error message display for API errors | nextjs-frontend-builder | 3.7.6 |
| 3.9.4 | Add form validation (email, password, description) | nextjs-frontend-builder | 3.7.6 |

#### 3.10 Responsive Design

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 3.10.1 | Apply mobile-first responsive styles | nextjs-frontend-builder | 3.9.4 |
| 3.10.2 | Test on 320px viewport (mobile) | nextjs-frontend-builder | 3.10.1 |
| 3.10.3 | Test on 1920px viewport (desktop) | nextjs-frontend-builder | 3.10.1 |

#### 3.11 Phase 3 Validation

| Step | Task | Agent | Dependencies |
|------|------|-------|--------------|
| 3.11.1 | Complete signup flow end-to-end | nextjs-frontend-builder | 3.10.3 |
| 3.11.2 | Complete signin flow end-to-end | nextjs-frontend-builder | 3.10.3 |
| 3.11.3 | Complete signout flow end-to-end | nextjs-frontend-builder | 3.10.3 |
| 3.11.4 | Create task end-to-end | nextjs-frontend-builder | 3.10.3 |
| 3.11.5 | View tasks (verify user isolation) | nextjs-frontend-builder | 3.10.3 |
| 3.11.6 | Update task end-to-end | nextjs-frontend-builder | 3.10.3 |
| 3.11.7 | Delete task end-to-end | nextjs-frontend-builder | 3.10.3 |
| 3.11.8 | Toggle task completion end-to-end | nextjs-frontend-builder | 3.10.3 |

---

## Task Summary

| Phase | Tasks | Agent Assignments |
|-------|-------|-------------------|
| Phase 1: Backend & Database | 20 | neon-postgres-architect, fastapi-backend |
| Phase 2: Authentication | 18 | auth-security, fastapi-backend |
| Phase 3: Frontend | 35 | nextjs-frontend-builder |
| **Total** | **73** | |

---

## Complexity Tracking

No constitution violations requiring justification. Implementation follows approved stack exactly.

---

## Risk Analysis

| Risk | Mitigation |
|------|------------|
| Better Auth JWT format mismatch | Verify token structure early in Phase 2 |
| Database connection issues | Test Neon connection before full implementation |
| CORS blocking requests | Configure CORS immediately after backend setup |
| Token expiration edge cases | Implement refresh flow or session redirect |

---

## Success Criteria Mapping

| Success Criterion | Phase | Validation Step |
|-------------------|-------|-----------------|
| SC-001: Registration <60s | Phase 3 | 3.11.1 |
| SC-002: Create task <10s | Phase 3 | 3.11.4 |
| SC-003: Task operations <5s | Phase 3 | 3.11.4-3.11.8 |
| SC-004: 401 for unauthenticated | Phase 2 | 2.6.1, 2.6.2 |
| SC-005: 403 for cross-user | Phase 2 | 2.6.4 |
| SC-006: Data persistence | Phase 3 | 3.11.5 |
| SC-007: Responsive UI | Phase 3 | 3.10.2, 3.10.3 |
| SC-008: All 5 operations | Phase 3 | 3.11.4-3.11.8 |
| SC-009: Page load <3s | Phase 3 | 3.11.1-3.11.8 |
| SC-010: Reproducibility | All | PHR records, plan docs |

---

## Generated Artifacts

| Artifact | Path | Purpose |
|----------|------|---------|
| research.md | specs/001-todo-fullstack-webapp/research.md | Technology decisions |
| data-model.md | specs/001-todo-fullstack-webapp/data-model.md | Database schema |
| openapi.yaml | specs/001-todo-fullstack-webapp/contracts/openapi.yaml | API contract |
| auth-flow.md | specs/001-todo-fullstack-webapp/contracts/auth-flow.md | Auth architecture |
| quickstart.md | specs/001-todo-fullstack-webapp/quickstart.md | Setup guide |
| plan.md | specs/001-todo-fullstack-webapp/plan.md | This implementation plan |

---

## Next Steps

1. Run `/sp.tasks` to generate detailed task list from this plan
2. Run `/sp.implement` to begin Phase 1 implementation
3. Each phase validated before proceeding to next
